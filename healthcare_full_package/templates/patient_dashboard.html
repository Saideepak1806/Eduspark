{% extends "base.html" %}
{% block content %}
<div class="row">
  <div class="col-md-8">
    <div class="card p-3">
      <h4>Your Files</h4>
      <form method="post" enctype="multipart/form-data" class="mb-3">
        <div class="d-flex gap-2">
          <input type="file" name="file" class="form-control" required>
          <button class="btn btn-primary">Upload (encrypted)</button>
        </div>
      </form>
      <ul class="list-group">
        {% for f in files %}
          <li class="list-group-item d-flex justify-content-between align-items-center">
            {{ f }}
            <span class="text-muted small">Encrypted</span>
          </li>
        {% else %}
          <li class="list-group-item">No files uploaded yet</li>
        {% endfor %}
      </ul>
    </div>

    <div class="card p-3 mt-3">
      <h4>Access Requests</h4>
      <ul class="list-group">
        {% for r in requests %}
          <li class="list-group-item">
            <div class="d-flex justify-content-between">
              <div>
                <strong>{{ r.doctor_username }}</strong> requested <em>{{ r.file }}</em>
                <div class="small text-muted">Request ID: {{ r.id }}</div>
              </div>
              <div class="text-end">
                {% if r.status == "Pending" %}
                  <a href="/patient/approve/{{ r.id }}" class="btn btn-sm btn-success">Approve</a>
                  <a href="/patient/reject/{{ r.id }}" class="btn btn-sm btn-warning">Reject</a>
                {% elif r.status == "Approved" %}
                  <span class="badge bg-success">Approved</span>
                {% else %}
                  <span class="badge bg-danger">Rejected</span>
                {% endif %}
              </div>
            </div>
          </li>
        {% else %}
          <li class="list-group-item">No requests</li>
        {% endfor %}
      </ul>
    </div>

  </div>

  <div class="col-md-4">
    <div class="card p-3">
      <h5>Quick Info</h5>
      <p class="small text-muted">Files are encrypted per patient and stored securely. Approve doctor requests to allow downloads.</p>
      <p><strong>Logged in as:</strong> {{ username }}</p>
    </div>
  </div>
</div>
{% endblock %}